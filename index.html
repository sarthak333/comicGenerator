<html>
  <head>
    <title>
      Generator
    </title>
    <link href="style.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet'>
  </head>
  <body onload="randomCheck()">
    <div id="topbar">
      <div class="row">
        <div class="col-3 perfectCenter topbarHeading">
          <img src="logo.jpg" class="brand">
        </div>  
        <div class="col-1 perfectCenter topbarHeading">
          <a href="#">Generator
          </a>
        </div>  
        <div class="col-1 perfectCenter topbarHeading inactive">
          <a href="archive.html">Archive
          </a>
        </div>  
        <div class="col-6">
        </div>  
      </div>
    </div>
    <section id="canvas">
      <div class="row">
        <div class="col-12 perfectCenter buttonDiv">
          <input type="button" class="button" value="Generate" onclick="randomCheck()">
        </div>
      </div>
      <div class="centerHorizontal">
        <div class="row title">
          <div class="col-12">
            <div class="row">
              <div class="col-1">
                <h3 id="number">
                </h3>
              </div>
              <div class="col-11">
                <h3 id="titleComic">
                </h3>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <div class="imageDiv">
              <img id="comic" src="" class="image">
            </div>
          </div>
        </div>        
      </div>
    </section>
    <script>
      let url,value,randomList,objString,count,localArray,arbitary,date;
      let comicHistory={
        day:"", month:"",year:"", viewTime:"",name:"",number:""};
      function randomCheck()
      {
        if(localStorage.array)
        {
          lastIndex=localStorage.lastIndex;
          lastIndex++;
          randomList=localStorage.array.split(',');
          if(lastIndex==randomList.length)
            lastIndex=0;
          value=randomList[lastIndex];
          count=localStorage.indexCount;
        }
        else
        {
          lastIndex=0;
          localArray=Array.from({
            length: 999}
                                ,(x,i) => i+1);
          localArray.sort(function(){
            return Math.random()-Math.random() }
                         );
          localStorage.array=localArray;
          localStorage.lastIndex=0;
          arbitary=0;
          value=localArray[arbitary];
          arbitary++;
          count=0;
        }
        date=new Date();
        url="https://xkcd.now.sh/"+value;
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
          if (this.readyState==4 && this.status==200) {
            var myObj = JSON.parse(this.responseText);
            document.getElementById('comic').src=myObj.img;
            comicHistory.name=myObj.safe_title;
            comicHistory.date=new Date();
            comicHistory.number=lastIndex;
            comicHistory.link=myObj.img;
            objString=JSON.stringify(comicHistory);
            localStorage['index'+lastIndex]=objString;
            localStorage['indexCount']=++count;
            document.getElementById('titleComic').innerHTML=myObj.safe_title;
            document.getElementById('number').innerHTML=lastIndex+1+".";
          }
        };
        xmlhttp.open("GET", url, true);
        xmlhttp.send();
        localStorage.lastIndex=lastIndex;
      }
    </script>
  </body>
</html>
